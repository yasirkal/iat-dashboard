<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IAT Digital – Tech Jobs (AU)</title>
  <!-- Tailwind (no build) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-slate-900">
  <div id="root"></div>

  <!-- React UMD + Babel Standalone (JSX transpile in-browser) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.26.2/babel.min.js"></script>

  <script type="text/babel" data-presets="env,react">
    const { useEffect, useMemo, useState } = React;
    const { createRoot } = ReactDOM;

    // ------------------ Config ------------------
    const PROXY_BASE = "https://iat-data-proxy.yasirkaleem.workers.dev";
    const ENDPOINTS = {
      ivi:  `${PROXY_BASE}/v1/data/jsa/ivi`,
      proj: `${PROXY_BASE}/v1/data/jsa/projections`,
      earn: `${PROXY_BASE}/v1/data/abs/earnings`,
      unemp:`${PROXY_BASE}/v1/data/abs/unemployment`,
    };
    const THEME = {
      brand: { name: "IAT Digital", primary: "#00539f", gradient: "from-[#0f172a] via-[#0b2a4a] to-[#00539f]" },
      layout: { max: "max-w-7xl", gutter: "px-5 sm:px-8" },
      radius: { xl: "rounded-2xl" }
    };
    const STREAMS = {
      all:      { label: "All Tech", codes: ["1351","2611","2612","2613","2621","2622","2631","2632","2633"] },
      ai:       { label: "AI",       codes: ["2613","2611","2612","2621"] },
      cyber:    { label: "Cyber",    codes: ["2622","2631","2632","1351"] },
      data:     { label: "Data",     codes: ["2611","2621","2613"] },
      cloud:    { label: "Cloud",    codes: ["2631","2621","1351"] },
      software: { label: "Software", codes: ["2613","2612","2632"] },
    };
    const TABS = Object.entries(STREAMS).map(([key, v]) => ({ key, label: v.label }));
    const COURSES = [
      { code: "AI",   title: "Artificial Intelligence", href: "https://www.iat.tafensw.edu.au/iat-digital/artificial-intelligence" },
      { code: "DATA", title: "Big Data",                href: "https://www.iat.tafensw.edu.au/iat-digital/big-data" },
      { code: "CLOUD",title: "Cloud Computing",         href: "https://www.iat.tafensw.edu.au/iat-digital/cloud-computing" },
      { code: "CYBER",title: "Cyber Security",          href: "https://www.iat.tafensw.edu.au/iat-digital/cyber-security" },
      { code: "SOFT", title: "Software",                href: "https://www.iat.tafensw.edu.au/iat-digital/software" },
    ];
    const nf = new Intl.NumberFormat("en-AU");
    const cf = new Intl.NumberFormat("en-AU", { style: "currency", currency: "AUD", maximumFractionDigits: 0 });

    async function getJSON(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Fetch failed " + res.status);
      return res.json();
    }
    function filterByCodes(rows, codes) {
      const set = new Set(codes);
      return (rows || []).filter((r) => set.has(String(r.anzsco4)));
    }

    // ------------------ Tiny SVG BarChart (no external libs) ------------------
    function SimpleBarChart({ data, xKey, yKey, valueFormatter=(v)=>v }) {
      // dimensions
      const width = 640, height = 260, padding = { top: 10, right: 10, bottom: 60, left: 60 };
      const innerW = width - padding.left - padding.right;
      const innerH = height - padding.top - padding.bottom;

      const labels = data.map(d => String(d[xKey]));
      const values = data.map(d => Number(d[yKey]) || 0);
      const maxVal = Math.max(1, ...values);

      const barW = innerW / Math.max(1, data.length);
      const tickCount = 4;

      return (
        <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-64">
          {/* axes */}
          <line x1={padding.left} y1={padding.top} x2={padding.left} y2={height - padding.bottom} stroke="#cbd5e1" />
          <line x1={padding.left} y1={height - padding.bottom} x2={width - padding.right} y2={height - padding.bottom} stroke="#cbd5e1" />

          {/* y ticks */}
          {Array.from({length: tickCount+1}).map((_,i) => {
            const tVal = (maxVal / tickCount) * i;
            const y = height - padding.bottom - (tVal / maxVal) * innerH;
            return (
              <g key={i}>
                <line x1={padding.left-4} x2={width - padding.right} y1={y} y2={y} stroke="#f1f5f9" />
                <text x={padding.left-8} y={y+4} textAnchor="end" fontSize="10" fill="#64748b">
                  {valueFormatter(tVal)}
                </text>
              </g>
            );
          })}

          {/* bars */}
          {data.map((d, i) => {
            const v = values[i];
            const bh = (v / maxVal) * innerH;
            const x = padding.left + i*barW + barW*0.1;
            const y = height - padding.bottom - bh;
            const w = barW*0.8;
            return (
              <g key={i}>
                <rect x={x} y={y} width={w} height={bh} fill="#00539f" rx="4"></rect>
              </g>
            );
          })}

          {/* x labels */}
          {labels.map((l, i) => {
            const x = padding.left + i*barW + barW*0.5;
            const y = height - padding.bottom + 12;
            return (
              <g key={i} transform={`rotate(-20 ${x} ${y})`}>
                <text x={x} y={y} textAnchor="end" fontSize="10" fill="#64748b">{l}</text>
              </g>
            );
          })}
        </svg>
      );
    }

    // ------------------ UI ------------------
    const Hero = () => (
      <section className="relative isolate overflow-hidden bg-gradient-to-br from-slate-950 via-slate-900 to-slate-800 text-white">
        <div className="absolute -inset-16 opacity-70 [mask-image:radial-gradient(60%_50%_at_50%_40%,black,transparent)] pointer-events-none">
          <div className={"h-[40rem] w-[140%] -translate-x-1/5 -translate-y-20 rotate-6 bg-gradient-to-r " + THEME.brand.gradient + " blur-3xl"} />
        </div>
        <div className={`${THEME.layout.max} ${THEME.layout.gutter} mx-auto py-28 sm:py-36 relative`}>
          <h1 className="text-4xl sm:text-6xl font-extrabold tracking-tight">
            Upskill for in-demand tech roles with <span className="text-sky-400">{THEME.brand.name}</span>
          </h1>
          <p className="mt-6 max-w-2xl text-lg text-slate-200">
            Short microcredentials in AI, Data, Cloud and Cyber — with live Australian job-market insight.
          </p>
          <div className="mt-10 flex flex-wrap gap-4">
            <a href="#courses" className="inline-flex items-center gap-2 rounded-full bg-sky-500 px-6 py-3 font-semibold text-slate-900 hover:bg-sky-400 transition">Explore courses</a>
            <a href="#jobs" className="inline-flex items-center gap-2 rounded-full border border-slate-600 px-6 py-3 font-semibold hover:bg-slate-800/60 transition">Tech job insights</a>
          </div>
        </div>
      </section>
    );

    const Courses = () => (
      <section id="courses" className="bg-white text-slate-900">
        <div className={`${THEME.layout.max} ${THEME.layout.gutter} mx-auto py-20`}>
          <h2 className="text-3xl sm:text-4xl font-bold">Courses</h2>
          <p className="mt-3 text-slate-600 max-w-2xl">Flexible, stackable units aligned to real job outcomes.</p>
          <div className="mt-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">
            {COURSES.map((c) => (
              <a key={c.code} href={c.href} className={`block h-full ${THEME.radius.xl} border border-slate-200 p-5 hover:shadow-lg transition bg-white`}>
                <div className="text-xs uppercase tracking-wider text-slate-500">{c.code}</div>
                <div className="mt-1 text-lg font-semibold">{c.title}</div>
                <div className="mt-6 inline-flex items-center gap-2 text-sky-600 font-medium">View →</div>
              </a>
            ))}
          </div>
        </div>
      </section>
    );

    function JobsDashboard() {
      const [tab, setTab] = useState("all");
      const [ivi, setIvi] = useState([]);
      const [proj, setProj] = useState([]);
      const [earn, setEarn] = useState([]);
      const [unemp, setUnemp] = useState([]);
      const [error, setError] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        let mounted = true;
        (async () => {
          try {
            setLoading(true);
            const [iviJson, projJson, earnJson, unempJson] = await Promise.all([
              getJSON(ENDPOINTS.ivi),
              getJSON(ENDPOINTS.proj),
              getJSON(ENDPOINTS.earn),
              getJSON(ENDPOINTS.unemp),
            ]);
            if (!mounted) return;
            setIvi(iviJson.rows || []);
            setProj(projJson.rows || []);
            setEarn(earnJson.rows || []);
            setUnemp(unempJson.rows || []);
            setError(null);
          } catch (e) {
            if (!mounted) return;
            setError(e?.message || "Data load failed");
          } finally {
            if (mounted) setLoading(false);
          }
        })();
        return () => { mounted = false; };
      }, []);

      const codes = STREAMS[tab].codes;
      const iviSel  = useMemo(() => filterByCodes(ivi,  codes), [ivi, codes]);
      const projSel = useMemo(() => filterByCodes(proj, codes), [proj, codes]);
      const earnSel = useMemo(() => filterByCodes(earn, codes), [earn, codes]);

      const medianWeekly = useMemo(() => {
        if (!earnSel.length) return null;
        const vals = earnSel.map((r) => r.median_weekly).filter((v) => v > 0).sort((a, b) => a - b);
        const mid = Math.floor(vals.length / 2);
        return vals.length % 2 ? vals[mid] : Math.round((vals[mid - 1] + vals[mid]) / 2);
      }, [earnSel]);

      const latestAds = useMemo(() => {
        if (!iviSel.length) return null;
        const latestMonth = iviSel.map((r) => r.month).sort().slice(-1)[0];
        const sum = iviSel.filter((r) => r.month === latestMonth).reduce((a, b) => a + (b.ads || 0), 0);
        return { month: latestMonth, ads: sum };
      }, [iviSel]);

      const employmentApprox = 650000;
      const occupancyPct = latestAds && latestAds.ads ? (employmentApprox / (employmentApprox + latestAds.ads)) * 100 : null;

      const yoyGrowthPct = useMemo(() => {
        if (!projSel.length) return null;
        const avg = projSel.reduce((a, b) => a + (b.growth_pct || 0), 0) / projSel.length;
        return Math.round(avg * 10) / 10;
      }, [projSel]);

      // chart data for our tiny SVG bar chart
      const earnBar = useMemo(() => earnSel.map((r) => ({
        occupation: r.occupation,
        value: r.median_weekly
      })), [earnSel]);

      const projBar = useMemo(() => projSel.map((r) => ({
        occupation: r.occupation,
        growth_pct: r.growth_pct,
      })), [projSel]);

      return (
        <section id="jobs" className="bg-slate-50">
          <div className={`${THEME.layout.max} ${THEME.layout.gutter} mx-auto py-20`}>
            <div className="flex flex-wrap items-center gap-2">
              <h2 className="text-3xl sm:text-4xl font-bold">Tech jobs in Australia</h2>
              {unemp.length > 0 && (
                <div className="ml-auto text-sm text-slate-600">
                  Headline unemployment: {Number(unemp[unemp.length - 1].value).toFixed(1)}%
                </div>
              )}
            </div>
            <p className="mt-3 max-w-3xl text-slate-600">
              Metrics tailored to ICT occupations (ANZSCO 4-digit). Sources: ABS (earnings) & Jobs and Skills Australia (IVI job ads & projections).
            </p>

            <div className="mt-6 flex flex-wrap gap-2">
              {TABS.map((t) => (
                <button key={t.key} onClick={() => setTab(t.key)} className={`rounded-full px-4 py-2 border text-sm ${tab === t.key ? "bg-sky-500 text-white border-sky-500" : "bg-white text-slate-700 border-slate-300 hover:bg-slate-100"}`}>
                  {t.label}
                </button>
              ))}
            </div>

            {error && <div className="mt-6 text-sm text-red-600">Data error: {error}</div>}
            {loading && <div className="mt-6 text-sm text-slate-500">Loading data…</div>}

            <div className="mt-8 grid grid-cols-1 md:grid-cols-4 gap-6">
              <div className={`bg-white ${THEME.radius.xl} border border-slate-200 p-6`}>
                <div className="text-slate-500 text-sm">Median weekly salary (tech)</div>
                <div className="mt-1 text-3xl font-bold">{medianWeekly ? cf.format(medianWeekly) : "—"}</div>
                <div className="mt-2 text-slate-500 text-xs">ABS Employee Earnings (ICT)</div>
              </div>
              <div className={`bg-white ${THEME.radius.xl} border border-slate-200 p-6`}>
                <div className="text-slate-500 text-sm">Job ads this month (IVI)</div>
                <div className="mt-1 text-3xl font-bold">{latestAds ? nf.format(latestAds.ads) : "—"}</div>
                <div className="mt-2 text-slate-500 text-xs">JSA Internet Vacancy Index</div>
              </div>
              <div className={`bg-white ${THEME.radius.xl} border border-slate-200 p-6`}>
                <div className="text-slate-500 text-sm">% jobs occupancy (proxy)</div>
                <div className="mt-1 text-3xl font-bold">{occupancyPct ? `${occupancyPct.toFixed(1)}%` : "—"}</div>
                <div className="mt-2 text-slate-500 text-xs">Employment / (Employment + Ads)</div>
              </div>
              <div className={`bg-white ${THEME.radius.xl} border border-slate-200 p-6`}>
                <div className="text-slate-500 text-sm">% growth (avg)</div>
                <div className="mt-1 text-3xl font-bold">{yoyGrowthPct != null ? `${yoyGrowthPct}%` : "—"}</div>
                <div className="mt-2 text-slate-500 text-xs">JSA Projections to May 2034</div>
              </div>
            </div>

            <div className="mt-10 grid grid-cols-1 lg:grid-cols-2 gap-8">
              <div className={`bg-white ${THEME.radius.xl} border border-slate-200 p-6`}>
                <h3 className="text-lg font-semibold">Median weekly earnings by occupation</h3>
                <div className="mt-4">
                  <SimpleBarChart
                    data={earnBar}
                    xKey="occupation"
                    yKey="value"
                    valueFormatter={(v)=>cf.format(Math.round(v))}
                  />
                </div>
                <p className="mt-2 text-xs text-slate-500">Source: ABS Employee Earnings (curated tech ANZSCO 4-digit).</p>
              </div>

              <div className={`bg-white ${THEME.radius.xl} border border-slate-200 p-6`}>
                <h3 className="text-lg font-semibold">Projected growth to 2034 (tech)</h3>
                <div className="mt-4">
                  <SimpleBarChart
                    data={projBar}
                    xKey="occupation"
                    yKey="growth_pct"
                    valueFormatter={(v)=>`${Math.round(v)}%`}
                  />
                </div>
                <p className="mt-2 text-xs text-slate-500">Source: Jobs and Skills Australia – Employment Projections (to May 2034).</p>
              </div>
            </div>
          </div>
        </section>
      );
    }

    const CTA = () => (
      <section className="relative isolate overflow-hidden bg-slate-900 text-white">
        <div className="absolute inset-0 -z-10 opacity-80 [mask-image:radial-gradient(50%_50%_at_50%_40%,black,transparent)]">
          <div className={"absolute -top-28 left-1/2 h-80 w-[120%] -translate-x-1/2 rotate-12 bg-gradient-to-r " + THEME.brand.gradient + " blur-3xl"}></div>
        </div>
        <div className={`${THEME.layout.max} ${THEME.layout.gutter} mx-auto py-20 text-center`}>
          <h2 className="text-3xl sm:text-4xl font-bold">Ready to start?</h2>
          <p className="mt-3 text-slate-200 max-w-2xl mx-auto">Join the next intake and build portfolio-ready skills in weeks, not years.</p>
          <div className="mt-8 flex justify-center">
            <a href="#courses" className="inline-flex items-center gap-2 rounded-full bg-sky-500 px-8 py-3 font-semibold text-slate-900 hover:bg-sky-400 transition">See intakes</a>
          </div>
        </div>
      </section>
    );

    const Footer = () => (
      <footer className="bg-white py-12">
        <div className={`${THEME.layout.max} ${THEME.layout.gutter} mx-auto grid sm:grid-cols-2 gap-6 text-sm text-slate-600`}>
          <div>
            <div className="font-semibold text-slate-900">{THEME.brand.name}</div>
            <p className="mt-2">© {new Date().getFullYear()} IAT Digital. All rights reserved.</p>
          </div>
          <div className="sm:text-right">Data sources: ABS; Jobs and Skills Australia</div>
        </div>
      </footer>
    );

    function App() {
      return (
        <main className="font-sans">
          <Hero />
          <Courses />
          <JobsDashboard />
          <CTA />
          <Footer />
        </main>
      );
    }

    createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
